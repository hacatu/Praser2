include_rules

export GCOV_PREFIX
export GCOV_PREFIX_STRIP

: foreach src/*.c |> !cccov |> obj/%B.o | notes/%B.gcno {obj}
: foreach src/modules/*.c |> !cccov |> obj/modules/%B.o | notes/%B.gcno
: foreach src/libs/*.c |> !cccov |> obj/libs/%B.o | notes/%B.gcno
: foreach obj/libs/*.o |> !ar |> lib/lib%B.a lib/<lib>
: foreach obj/modules/*.o | lib/<lib> |> !socov %<lib> |> lib/lib%B.so {mod}
: obj/parser_runner.o | lib/<lib> {mod} |> gcc $(LDFLAGS) --coverage %f -o %o -Wl,-rpath=@(BUILD_ROOT)/lib -lparser -last_compiler -last_interpreter -llanguage_generator -lavl -lsla -last_callback_stub -lstub_parser |> bin/parser_runner
: src/parser.pra | bin/parser_runner {mod} |> ./parser_runner.sh parser compile %f %o |> src/modules/generated_parser.c
: src/modules/generated_parser.c |> !cccov |> obj/modules/%B.o | notes/%B.gcno
: obj/modules/generated_parser.o | lib/<lib> |> !socov %<lib> |> lib/lib%B.so
: src/umbrella.pra | bin/parser_runner {mod} lib/libgenerated_parser.so |> ./parser_runner.sh generated compile %f %o |> src/modules/umbrella_parser.c
: src/modules/umbrella_parser.c |> !cccov |> obj/modules/%B.o | notes/%B.gcno
: obj/modules/umbrella_parser.o | lib/<lib> |> !socov %<lib> |> lib/lib%B.so

